# RustCode Component

React component for rendering Rust code with syntax highlighting and clickable type links. This is the core component used by `cargo-doc-docusaurus` for displaying Rust code blocks in Docusaurus documentation.

## Features

- ✅ **Syntax highlighting** using Prism.js (Docusaurus built-in)
- ✅ **Clickable type links** - navigate to type documentation
- ✅ **Inline mode** - for method signatures without background
- ✅ **Block mode** - for full code examples with background
- ✅ **Theme-aware** - respects Docusaurus light/dark mode
- ✅ **CSS Modules** - scoped styles, no global conflicts

## Installation

### Prerequisites

- Docusaurus 3.x site
- TypeScript support (recommended)

### Steps

1. **Copy the component directory:**
   ```bash
   cp -r templates/RustCode/ your-docusaurus-site/src/components/
   ```

2. **Rename template files:**
   ```bash
   cd your-docusaurus-site/src/components/RustCode/
   mv index.tsx.txt index.tsx
   mv styles.module.css.txt styles.module.css
   ```

3. **Verify structure:**
   ```
   src/components/RustCode/
   ├── index.tsx           # React component
   └── styles.module.css   # Component styles
   ```

That's it! The component is now available for import.

## Usage

### Basic Usage

```tsx
import RustCode from '@site/src/components/RustCode';

// Simple code block
<RustCode code="pub fn hello_world() {
    println!(\"Hello, world!\");
}" />
```

### Inline Mode

For method signatures or type annotations without background:

```tsx
<RustCode inline code="fn process(&self, data: Vec<u8>)" />
```

### With Type Links

Add clickable links to types:

```tsx
<RustCode 
  code="fn create_user(name: String, email: Email) -> User"
  links={[
    { text: "Email", href: "/docs/rust/my_crate/struct.Email" },
    { text: "User", href: "/docs/rust/my_crate/struct.User" }
  ]}
/>
```

### In MDX Files

```mdx
---
title: My API
---

import RustCode from '@site/src/components/RustCode';

## Function Signature

<RustCode inline code="pub fn process(data: &[u8]) -> Result<String, Error>" />

## Example

<RustCode code={`
fn main() {
    let result = process(b"hello");
    println!("{:?}", result);
}
`} />
```

## Props

| Prop | Type | Required | Description |
|------|------|----------|-------------|
| `code` | `string` | ✅ | The Rust code to display |
| `links` | `TypeLink[]` | ❌ | Array of clickable type links |
| `inline` | `boolean` | ❌ | Inline mode (no background) |

### TypeLink Interface

```typescript
interface TypeLink {
  text: string;   // The text to make clickable (e.g., "Vec", "Option")
  href: string;   // The link destination (e.g., "/docs/rust/std/vec/struct.Vec")
}
```

## Styling

The component uses **CSS Modules** for scoped styling. Styles are defined in `styles.module.css`.

### Available Classes

```css
.inlineCode {
  /* Inline mode styles (method signatures) */
  font-family: var(--ifm-font-family-monospace);
  font-size: 0.9375em;
  display: block;
  white-space: pre;
  line-height: 1.5;
}

.typeLink {
  /* Clickable type links */
  text-decoration: none;
  cursor: pointer;
  border-bottom: 1px dotted currentColor;
}

.typeLink:hover {
  opacity: 0.8;
}
```

### Customization

You can override styles using CSS variables in your `custom.css`:

```css
/* In src/css/custom.css */
:root {
  --ifm-font-family-monospace: 'Fira Code', 'Consolas', monospace;
}

/* Adjust inline code font size */
.rust-inline-code {
  font-size: 1em !important;
}
```

## How It Works

1. **Receives code string** and optional type links
2. **Wraps code in Prism language block** (`language-rust`)
3. **Applies inline/block styling** based on `inline` prop
4. **Injects clickable links** by replacing type names with `<Link>` components
5. **Docusaurus automatically** syntax-highlights using Prism.js

## Generated by cargo-doc-docusaurus

This component is used automatically by `cargo-doc-docusaurus` in generated markdown:

```mdx
<RustCode 
  inline 
  code="pub struct User { 
    pub name: String, 
    pub email: Email,
  }" 
  links={[{text: "Email", href: "/docs/rust/my_crate/struct.Email"}]}
/>
```

## Examples

### Method Signature

```tsx
<RustCode 
  inline 
  code="fn connect(addr: SocketAddr) -> Result<Connection, Error>"
  links={[
    { text: "SocketAddr", href: "/docs/rust/std/net/struct.SocketAddr" },
    { text: "Connection", href: "/docs/rust/my_crate/struct.Connection" },
    { text: "Error", href: "/docs/rust/my_crate/enum.Error" }
  ]}
/>
```

### Struct Definition

```tsx
<RustCode code={`pub struct User {
    pub id: UserId,
    pub name: String,
    pub email: Email,
}`} 
links={[
  { text: "UserId", href: "/docs/rust/my_crate/type.UserId" },
  { text: "Email", href: "/docs/rust/my_crate/struct.Email" }
]}
/>
```

### Trait Implementation

```tsx
<RustCode code={`impl Display for User {
    fn fmt(&self, f: &mut Formatter) -> fmt::Result {
        write!(f, "{} <{}>", self.name, self.email)
    }
}`}
links={[
  { text: "Display", href: "/docs/rust/std/fmt/trait.Display" },
  { text: "Formatter", href: "/docs/rust/std/fmt/struct.Formatter" }
]}
/>
```

## Troubleshooting

### Links not working

Make sure the `href` paths match your Docusaurus routing configuration. If you use `--base-path` with `cargo-doc-docusaurus`, the links will be automatically prefixed.

### Syntax highlighting not working

Docusaurus includes Prism.js by default. Make sure you haven't disabled it in `docusaurus.config.js`.

### Styles not applying

1. Check that `styles.module.css` exists in the same directory
2. Verify the import in `index.tsx` is correct
3. Check browser DevTools for CSS module class names

## Related Components

- **RustCrateLink** - For displaying crate titles in sidebars
- **RustModuleTitle** - For displaying module titles in sidebars
- **DocSidebarItem/Link** - For applying Rust item colors in sidebar navigation
