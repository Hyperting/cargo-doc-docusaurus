# Setup Guide

Complete guide for integrating cargo-doc-docusaurus with Docusaurus.

## Prerequisites

- Rust nightly (for JSON output)
- Node.js 18+ and npm/yarn
- Docusaurus 3.x site

```bash
# Check versions
rustc +nightly --version
node --version
```

## Installation

```bash
cargo install cargo-doc-docusaurus
```

## Setup Steps

### 1. Create or Use Existing Docusaurus Site

**New site:**
```bash
npx create-docusaurus@latest my-docs classic
cd my-docs
npm install
```

**Existing site:** Skip to step 2.

### 2. Install Components

From your Docusaurus root:

```bash
cargo doc-docusaurus components init .
```

This installs:
- React components (RustCode, RustCrateLink, RustModuleTitle)
- Theme overrides (DocSidebarItem/Link for colored sidebar)
- CSS styles (rust-documentation.css)

**Note:** Files that already exist are skipped (no overwrites).

### 3. Configure CSS

Add to `docusaurus.config.js` (or `.ts`):

```javascript
module.exports = {
  // ... other config
  stylesheets: [
    {
      href: '/css/rust-documentation.css',
    },
  ],
};
```

### 4. Generate Documentation

```bash
# Generate rustdoc JSON
RUSTDOCFLAGS="-Z unstable-options --output-format json" \
  cargo +nightly doc --no-deps

# Convert to markdown
cargo doc-docusaurus target/doc/my_crate.json \
  -o docs/api \
  --base-path "/docs/api"
```

### 5. Import Sidebar

Add to your `sidebars.ts`:

```typescript
import type {SidebarsConfig} from '@docusaurus/plugin-content-docs';
import {rustSidebars} from './docs/api/sidebars-rust';

const sidebars: SidebarsConfig = {
  // Your existing sidebars
  mySidebar: [{type: 'autogenerated', dirName: '.'}],
  
  // Add Rust docs sidebar
  ...rustSidebars,
};

export default sidebars;
```

### 6. Run Docusaurus

```bash
npm start
# Visit http://localhost:3000/docs/api/my_crate
```

## Multi-Crate Workspaces

For workspaces with multiple crates:

```bash
# Define workspace crates for internal linking
WORKSPACE_CRATES="crate_a,crate_b,crate_c"

# Generate JSON for all crates
RUSTDOCFLAGS="-Z unstable-options --output-format json" \
  cargo +nightly doc --no-deps

# Convert each crate
for crate in crate_a crate_b crate_c; do
  cargo doc-docusaurus target/doc/${crate}.json \
    -o docs/api \
    --base-path "/docs/api" \
    --workspace-crates "$WORKSPACE_CRATES"
done
```

**Result:** Links between workspace crates use internal paths instead of docs.rs.

## Customization

### Colors

Get customizable CSS variables:

```bash
# Show variables with explanation
cargo doc-docusaurus components css-vars

# Append to custom.css
cargo doc-docusaurus components css-vars --css-only >> src/css/custom.css
```

Then edit `src/css/custom.css`:

```css
:root {
  --rust-color-module: rgb(255, 120, 0);     /* Orange modules */
  --rust-color-struct: rgb(0, 150, 200);     /* Blue structs */
}

[data-theme='dark'] {
  --rust-color-module: rgb(255, 180, 100);
  --rust-color-struct: rgb(100, 200, 250);
}
```

See [templates/CSS_GUIDE.md](templates/CSS_GUIDE.md) for all available variables.

### Sidebar

Edit generated `sidebars-rust.ts` to reorganize:

```typescript
export const rustSidebars = {
  rustSidebar: [
    {
      type: 'doc',
      id: 'api/my_crate/index',
      label: 'Overview',
    },
    {
      type: 'category',
      label: 'Core',
      items: [
        // Move important items here
      ],
    },
  ],
};
```

## CI/CD Integration

### GitHub Actions

```yaml
name: Generate Docs

on:
  push:
    branches: [main]

jobs:
  docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - uses: dtolnay/rust-toolchain@nightly
      
      - name: Install cargo-doc-docusaurus
        run: cargo install cargo-doc-docusaurus
      
      - name: Generate JSON
        run: |
          RUSTDOCFLAGS="-Z unstable-options --output-format json" \
            cargo +nightly doc --no-deps
      
      - name: Convert to markdown
        run: |
          cargo doc-docusaurus target/doc/my_crate.json \
            -o docs/api \
            --base-path "/docs/api"
      
      - name: Commit docs
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add docs/
          git commit -m "Update documentation" || echo "No changes"
          git push
```

### GitLab CI

```yaml
generate-docs:
  image: rust:latest
  before_script:
    - rustup default nightly
    - cargo install cargo-doc-docusaurus
  script:
    - RUSTDOCFLAGS="-Z unstable-options --output-format json" 
        cargo +nightly doc --no-deps
    - cargo doc-docusaurus target/doc/my_crate.json 
        -o docs/api 
        --base-path "/docs/api"
  artifacts:
    paths:
      - docs/
```
